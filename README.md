# Bannerbear Signed URLs

[Signed URLs](https://www.bannerbear.com/integrations/signed-urls/) are a way to use Bannerbear to generate images on demand using only URL parameters.

The standard Bannerbear product is a [REST API](https://www.bannerbear.com/product/image-generation-api/) accessed using an API key. 

Signed URLs *do not use the API key* in the URL params as by nature these params will be publicly visible. Instead, the Signed URL uses an encrypted signature so that the API key is never publicly exposed.

### Example Image

This url is an example signed url. Notice that if you try to change any of the parameters, the response becomes invalid.

[https://cdn.bannerbear.com/signedurl/NQ537aZE0aaevwj8bP/image.jpg?modifications=W3sibmFtZSI6InBob3RvIiwiaW1hZ2VfdXJsIjoiaHR0cHM6Ly93d3cuYmFubmVyYmVhci5jb20vaW1hZ2VzL2Jsb2cvcGhvdG8tMTQ5NTYzOTg2NzM4Ny01NDIzZDY4MTE1ODMtMS5qcGVnIn0seyJuYW1lIjoidGl0bGUiLCJ0ZXh0IjoiV2lsbCBBSSBFdmVyIFJlcGxhY2UgRGVzaWduZXJzPyJ9LHsibmFtZSI6InJlYWRpbmciLCJ0ZXh0IjoiOCBtaW51dGUgcmVhZCJ9LHsibmFtZSI6ImF2YXRhciIsImltYWdlX3VybCI6Imh0dHBzOi8vd3d3LmJhbm5lcmJlYXIuY29tL2ltYWdlcy9hdXRob3JfeW9uZ2Zvb2suanBnIn0seyJuYW1lIjoibmFtZSIsInRleHQiOiJKb24gWW9uZ2Zvb2sifSx7Im5hbWUiOiJkYXRlIiwidGV4dCI6Ik5vdmVtYmVyIDIwMTkifV0&s=f96c93cbd31349e6b5ad907e4a14af71223e5f30fe13a0a230f507b1732219cb](https://cdn.bannerbear.com/signedurl/NQ537aZE0aaevwj8bP/image.jpg?modifications=W3sibmFtZSI6InBob3RvIiwiaW1hZ2VfdXJsIjoiaHR0cHM6Ly93d3cuYmFubmVyYmVhci5jb20vaW1hZ2VzL2Jsb2cvcGhvdG8tMTQ5NTYzOTg2NzM4Ny01NDIzZDY4MTE1ODMtMS5qcGVnIn0seyJuYW1lIjoidGl0bGUiLCJ0ZXh0IjoiV2lsbCBBSSBFdmVyIFJlcGxhY2UgRGVzaWduZXJzPyJ9LHsibmFtZSI6InJlYWRpbmciLCJ0ZXh0IjoiOCBtaW51dGUgcmVhZCJ9LHsibmFtZSI6ImF2YXRhciIsImltYWdlX3VybCI6Imh0dHBzOi8vd3d3LmJhbm5lcmJlYXIuY29tL2ltYWdlcy9hdXRob3JfeW9uZ2Zvb2suanBnIn0seyJuYW1lIjoibmFtZSIsInRleHQiOiJKb24gWW9uZ2Zvb2sifSx7Im5hbWUiOiJkYXRlIiwidGV4dCI6Ik5vdmVtYmVyIDIwMTkifV0&s=f96c93cbd31349e6b5ad907e4a14af71223e5f30fe13a0a230f507b1732219cb)

## Table of Contents

- [How it Works](#how-it-works)
- [Create a Signed URL Base](#create-a-signed-url-base)
- [Modifications](#modifications)
- [Signing the URL](#signing-the-url)
- [Advanced: Using Base64](#advanced-using-base64)
- [On-Demand Signed URLs](#on-demand-signed-urls)
- [Troubleshooting](#troubleshooting)

## How it Works

There are two types of signed urls with Bannerbear. Standard and On-Demand. You may use either approach, or a mix of both in your applications, depending on your use-case.

When a fresh and properly-signed URL is accessed, this chain of events happens:

**Standard Signed URLs**

- URL signature is validated
- Placeholder image is displayed
- Image is generated by Bannerbear *asynchronously*
- On subsequent requests, the generated image is served by CDN

**On-Demand Signed URLs**

- URL signature is validated
- HTTP request is held open while image generates
- Image is generated *synchronously* and returned
- On subsequent requests, the generated image is served by CDN

There are pros and cons to each approach.

## Create a Signed URL Base

Signed URLs are attached at the template level in Bannerbear. To start using Signed URLs, create a Signed URL Base. This is a unique endpoint associated with a template. You can create as many Bases as you want for each template. For most cases you will only need to create one Base for a template, but for flexibility Bannerbear allows you to create multiple Bases per template.

## Modifications

Bannerbear expects all modifications to appear in the url parameter `modifications` as a Base64-encoded JSON array.

You can grab some sample JSON for your template from the template's API Console e.g.

```json
[
  {
    "name": "message",
    "text": "Hello World"
  },
  {
    "name": "face",
    "image_url": "https://cdn.bannerbear.com/sample_images/welcome_bear_photo.jpg"
  }
]
```

## Signing the URL

Bannerbear expects the signature to appear in the parameter `s`

`&s=` should be the *last parameter* in your URLs

The signature is calculated using HMAC

### Signing Example

This example is in Ruby but you can find other language examples in the repository.

```ruby
#api_key: your project API key - keep this safe and non-public
api_key = "YOUR_KEY"

#base: this signed url base
base = "https://cdn.bannerbear.com/signedurl/YOUR_ID/image.jpg"

#modifications: grab this JSON from your template API Console and modify as needed
modifications = [{"name":"title","text":"YOUR_TITLE"}]

#create the query string
query = "?modifications=" + Base64.urlsafe_encode64(modifications.to_json, :padding => false)

#calculate the signature
signature = OpenSSL::HMAC.hexdigest("SHA256", api_key, base + query)

#append the signature
return base + query + "&s=" + signature
```

The returned URL at the end of this script is a signed url that will generate an image when accessed.

## On-Demand Signed URLs

On-demand signed urls generate images synchronously in a single HTTP request. This makes them suitable for website meta tags, emails and more.

The process for creating on-demand signed urls is the same as the standard process.

The only difference is that *after you have created* the signed url, simply substitute `cdn.bannerbear.com` with `on-demand.bannerbear.com`

This will point the url at the on-demand server endpoint and will render your image inline.

[Example Standard Signed URL](https://cdn.bannerbear.com/signedurl/NQ537aZE0aaevwj8bP/image.jpg?modifications=W3sibmFtZSI6InBob3RvIiwiaW1hZ2VfdXJsIjoiaHR0cHM6Ly93d3cuYmFubmVyYmVhci5jb20vaW1hZ2VzL2Jsb2cvcGhvdG8tMTQ5NTYzOTg2NzM4Ny01NDIzZDY4MTE1ODMtMS5qcGVnIn0seyJuYW1lIjoidGl0bGUiLCJ0ZXh0IjoiV2lsbCBBSSBFdmVyIFJlcGxhY2UgRGVzaWduZXJzPyJ9LHsibmFtZSI6InJlYWRpbmciLCJ0ZXh0IjoiOCBtaW51dGUgcmVhZCJ9LHsibmFtZSI6ImF2YXRhciIsImltYWdlX3VybCI6Imh0dHBzOi8vd3d3LmJhbm5lcmJlYXIuY29tL2ltYWdlcy9hdXRob3JfeW9uZ2Zvb2suanBnIn0seyJuYW1lIjoibmFtZSIsInRleHQiOiJKb24gWW9uZ2Zvb2sifSx7Im5hbWUiOiJkYXRlIiwidGV4dCI6Ik5vdmVtYmVyIDIwMTkifV0&s=f96c93cbd31349e6b5ad907e4a14af71223e5f30fe13a0a230f507b1732219cb)

[Example On-Demand Signed URL](https://on-demand.bannerbear.com/signedurl/NQ537aZE0aaevwj8bP/image.jpg?modifications=W3sibmFtZSI6InBob3RvIiwiaW1hZ2VfdXJsIjoiaHR0cHM6Ly93d3cuYmFubmVyYmVhci5jb20vaW1hZ2VzL2Jsb2cvcGhvdG8tMTQ5NTYzOTg2NzM4Ny01NDIzZDY4MTE1ODMtMS5qcGVnIn0seyJuYW1lIjoidGl0bGUiLCJ0ZXh0IjoiV2lsbCBBSSBFdmVyIFJlcGxhY2UgRGVzaWduZXJzPyJ9LHsibmFtZSI6InJlYWRpbmciLCJ0ZXh0IjoiOCBtaW51dGUgcmVhZCJ9LHsibmFtZSI6ImF2YXRhciIsImltYWdlX3VybCI6Imh0dHBzOi8vd3d3LmJhbm5lcmJlYXIuY29tL2ltYWdlcy9hdXRob3JfeW9uZ2Zvb2suanBnIn0seyJuYW1lIjoibmFtZSIsInRleHQiOiJKb24gWW9uZ2Zvb2sifSx7Im5hbWUiOiJkYXRlIiwidGV4dCI6Ik5vdmVtYmVyIDIwMTkifV0&s=f96c93cbd31349e6b5ad907e4a14af71223e5f30fe13a0a230f507b1732219cb)

Notice how the query string is exactly the same - only the domain is different.

## Troubleshooting

Getting your signature to match the one Bannerbear expects can be tricky at first. Here are some common issues if you're seeing an `invalid signature` error:

- Ensure `&s=` is the last parameter in your URL
- Signature should be calculated *before* appending the `&s=` parameter
- Signature should be calculated using HMAC
- Ensure that you are not changing the query string after calculating the signature

## Pull Requests Welcome

We welcome any additional code examples showing how to build Bannerbear Signed URLs in languages not covered here, or updates to our existing examples to make them read better.
